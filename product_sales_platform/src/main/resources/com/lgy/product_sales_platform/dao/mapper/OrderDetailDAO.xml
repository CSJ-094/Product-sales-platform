<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lgy.product_sales_platform.dao.OrderDetailDAO">

    <!-- 주문 상세 정보 저장 -->
    <insert id="save" parameterType="com.lgy.product_sales_platform.dto.OrderDetailDTO">
        INSERT INTO ORDER_DETAILS (ORDERDETAILID, ORDERID, PRODUCTID, QUANTITY, PRICE)
        VALUES (ORDER_DETAIL_SEQ.NEXTVAL, #{orderId}, #{productId}, #{quantity}, #{price})
    </insert>

    <!-- 특정 주문 ID에 해당하는 첫 번째 상품의 ID를 조회 -->
    <select id="findFirstProductIdByOrderId" resultType="long">
        SELECT PRODUCTID
        FROM ORDER_DETAILS
        WHERE ORDERID = #{orderId}
        ORDER BY ORDERDETAILID ASC
        FETCH FIRST 1 ROW ONLY
    </select>

</mapper>
